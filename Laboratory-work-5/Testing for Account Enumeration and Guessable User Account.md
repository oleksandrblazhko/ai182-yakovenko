# Тестирование перечисления учетных записей и угадываемой учетной записи пользователя 
## Резюме 
Цель этого теста — проверить, возможно ли собрать набор действительных имен пользователей, взаимодействуя с механизмом аутентификации приложения. Этот тест будет полезен для тестирования грубой силы, в котором тестер проверяет, возможно ли найти соответствующий пароль с учетом действительного имени пользователя.

Часто веб-приложения обнаруживают наличие имени пользователя в системе либо вследствие неправильной настройки, либо в результате дизайнерского решения. Например, иногда, когда мы отправляем неправильные учетные данные, мы получаем сообщение о том, что либо имя пользователя присутствует в системе, либо предоставленный пароль неверен. Полученная информация может быть использована злоумышленником для получения списка пользователей в системе. Эта информация может быть использована для атаки на веб-приложение, например, путем перебора или атаки по имени пользователя и паролю по умолчанию.

Тестировщик должен взаимодействовать с механизмом аутентификации приложения, чтобы понять, вызывает ли отправка определенных запросов ответ приложения по-разному. Эта проблема возникает из-за того, что информация, выпущенная веб-приложением или веб-сервером, когда пользователь указывает действительное имя пользователя, отличается от информации, когда он использует недопустимое имя.

В некоторых случаях получено сообщение, в котором указывается, неверны ли предоставленные учетные данные из-за того, что было использовано недопустимое имя пользователя или неверный пароль. Иногда тестировщики могут перечислить существующих пользователей, отправив имя пользователя и пустой пароль. 

## Цели теста 
- Просмотрите процессы, относящиеся к идентификации пользователя ( например , регистрация, вход в систему и т. д.). 
- Перечислите пользователей, где это возможно, с помощью анализа ответов. 
## Как проверить 
При тестировании методом «черного ящика» тестер ничего не знает о конкретном приложении, имени пользователя, логике приложения, сообщениях об ошибках на странице входа или средствах восстановления пароля. Если приложение уязвимо, тестер получает ответное сообщение, прямо или косвенно раскрывающее некоторую информацию, полезную для подсчета пользователей. 
### HTTP-ответное сообщение 
#### Проверка действительных учетных данных 
Запишите ответ сервера при отправке действительного идентификатора пользователя и действительного пароля. 

 
_Используя веб-прокси, обратите внимание на информацию, полученную в результате этой успешной аутентификации (ответ HTTP 200, длина ответа)._

#### Проверка действительного пользователя с неправильным паролем

Теперь тестер должен попытаться ввести действительный идентификатор пользователя и неправильный пароль и записать сообщение об ошибке, сгенерированное приложением. 
_Браузер должен отобразить сообщение, похожее на следующее:_
![image](https://owasp.org/www-project-web-security-testing-guide/stable/4-Web_Application_Security_Testing/03-Identity_Management_Testing/images/AuthenticationFailed.png)

_Рисунок 4.3.4-1: Ошибка аутентификации_

_В отличие от любого сообщения, раскрывающего существование пользователя, например:_

`_Login for User foo: invalid password_`

_Используя веб-прокси, обратите внимание на информацию, полученную в результате этой неудачной попытки аутентификации (отклик HTTP 200, длина ответа)._

#### Проверка несуществующего имени пользователя 

Теперь тестер должен попытаться ввести неверный идентификатор пользователя и неправильный пароль и записать ответ сервера (тестер должен быть уверен, что имя пользователя недопустимо в приложении). Запишите сообщение об ошибке и ответ сервера. 

_Если тестировщик введет несуществующий идентификатор пользователя, он может получить сообщение, подобное следующему:_
![image](https://owasp.org/www-project-web-security-testing-guide/stable/4-Web_Application_Security_Testing/03-Identity_Management_Testing/images/Userisnotactive.png)

_Рисунок 4.3.4-3: Этот пользователь не активен_

_или сообщение, подобное следующему:_

`_Login failed for User foo: invalid Account_`

_Как правило, приложение должно отвечать одним и тем же сообщением об ошибке и длиной на разные некорректные запросы. Если ответы не совпадают, тестер должен исследовать и найти ключ, который создает разницу между двумя ответами. Например:_

_1. Запрос клиента: Действительный пользователь/неправильный пароль_

_2. Ответ сервера: Пароль неверный_

_3. Запрос клиента: Неверный пользователь/неверный пароль_

_4. Ответ сервера: Пользователь не распознан_

_Приведенные выше ответы позволяют клиенту понять, что для первого запроса у него есть действительное имя пользователя. Таким образом, они могут взаимодействовать с приложением, запрашивая набор возможных идентификаторов пользователей и наблюдая за ответом._

_Глядя на второй ответ сервера, тестер точно так же понимает, что у них нет действительного имени пользователя. Таким образом, они могут взаимодействовать таким же образом и создавать список действительных идентификаторов пользователей, просматривая ответы сервера._

### Другие способы перечисления пользователей 

Тестировщики могут перечислять пользователей несколькими способами, например: 

#### Анализ кода ошибки, полученного на страницах входа 

Некоторые веб-приложения выпускают определенный код ошибки или сообщение, которое мы можем проанализировать. 

#### Анализ URL-адресов и перенаправлений URL-адресов

Например:
- `http://www.foo.com/err.jsp?User=baduser&Error=0`
- `http://www.foo.com/err.jsp?User=gooduser&Error=2`

Как видно выше, когда тестировщик предоставляет идентификатор пользователя и пароль веб-приложению, он видит сообщение, указывающее, что в URL-адресе произошла ошибка. В первом случае они предоставили неверный идентификатор пользователя и неверный пароль. Во втором — хороший идентификатор пользователя и неверный пароль, чтобы они могли идентифицировать действительный идентификатор пользователя. 

#### Зондирование URI 

Иногда веб-сервер реагирует по-разному, если он получает запрос на существующий каталог или нет. Например, на некоторых порталах каждый пользователь связан с каталогом. Если тестировщики попытаются получить доступ к существующему каталогу, они могут получить ошибку веб-сервера.

Некоторые из распространенных ошибок, полученных от веб-серверов: 

- 403 Запрещенный код ошибки 
- 404 Не найден код ошибки 

Пример: 

- `http://www.foo.com/account1- получаем от веб сервера: 403 Forbidden`
- `http://www.foo.com/account2- получаем от веб сервера: 404 файл не найден`

В первом случае пользователь существует, но тестировщик не может просмотреть веб-страницу, во втором случае пользователь «account2» не существует. Собирая эту информацию, тестировщики могут подсчитывать пользователей. 

#### Анализ заголовков веб-страниц 

Тестировщики могут получить полезную информацию в заголовке веб-страницы, где они могут получить конкретный код ошибки или сообщения, которые показывают, связаны ли проблемы с именем пользователя или паролем. 


Например, если пользователь не может пройти аутентификацию в приложении и получает веб-страницу с заголовком, похожим на: 

- `Invalid user`
- `Invalid authentication`

#### Анализ сообщения, полученного от средства восстановления 

Когда мы используем средство восстановления (т. е. функцию забытого пароля), уязвимое приложение может возвращать сообщение, которое показывает, существует ли имя пользователя или нет. 

Например, сообщения, подобные следующему: 

- `Invalid username: email address is not valid or the specified user was not found.`
- `Valid username: Your password has been successfully sent to the email address you registered with.`

#### Дружественное сообщение об ошибке 404 

Когда мы запрашиваем пользователя в несуществующем каталоге, мы не всегда получаем код ошибки 404. Вместо этого мы можем получить «200 ok» с изображением, в этом случае мы можем предположить, что когда мы получаем конкретное изображение, пользователь не существует. Эта логика может быть применена к ответу другого веб-сервера; хитрость заключается в хорошем анализе сообщений веб-сервера и веб-приложения. 

#### Анализ времени отклика 

Помимо рассмотрения содержания ответов, следует также учитывать время, необходимое для ответа. В частности, когда запрос вызывает взаимодействие с внешней службой (например, отправка сообщения электронной почты о забытом пароле), это может добавить к ответу несколько сотен миллисекунд, которые можно использовать для определения того, является ли запрошенный пользователь действительным. 

#### Угадывание пользователей 
В некоторых случаях идентификаторы пользователей создаются с помощью определенных политик администратора или компании. Например, мы можем просмотреть пользователя с идентификатором пользователя, созданным в последовательном порядке: 

`CN000100
CN000101
...`

Иногда имена пользователей создаются с псевдонимом REALM, а затем порядковыми номерами: 

- R1001 — пользователь 001 для REALM1 
- R2001 — пользователь 001 для REALM2

В приведенном выше примере мы можем создать простые сценарии оболочки, которые составляют идентификаторы пользователей и отправляют запрос с помощью такого инструмента, как wget, для автоматизации веб-запроса для определения действительных идентификаторов пользователей. Для создания скрипта мы также можем использовать Perl и curl. 

Другие возможности: - идентификаторы пользователей, связанные с номерами кредитных карт, или вообще номера с шаблоном. - идентификаторы пользователей, связанные с реальными именами, например, если у Фредди Меркьюри идентификатор пользователя «fmercury», то вы можете предположить, что у Роджера Тейлора идентификатор пользователя «rtaylor». 

Опять же, мы можем угадать имя пользователя из информации, полученной из запроса LDAP или из сбора информации Google, например, из определенного домена. Google может помочь найти пользователей домена с помощью конкретных запросов или с помощью простого сценария или инструмента оболочки. 

`Перечисляя учетные записи пользователей, вы рискуете заблокировать учетные записи после предопределенного количества неудачных попыток (на основе политики приложения). Кроме того, иногда ваш IP-адрес может быть заблокирован динамическими правилами брандмауэра приложений или системы предотвращения вторжений.`

### Тестирование серого ящика 

#### Проверка сообщений об ошибках аутентификации 

Убедитесь, что приложение одинаково отвечает на каждый клиентский запрос, который приводит к сбою проверки подлинности. Для этой проблемы тестирование черного ящика и тестирование серого ящика имеют одинаковую концепцию, основанную на анализе сообщений или кодов ошибок, полученных от веб-приложения. 

`Приложение должно отвечать одинаковым образом на каждую неудачную попытку аутентификации.`

`Например: отправленные учетные данные недействительны`

### Исправление 

Убедитесь, что приложение возвращает согласованные общие сообщения об ошибках в ответ на недопустимое имя учетной записи, пароль или другие учетные данные пользователя, введенные в процессе входа в систему. 

Убедитесь, что системные учетные записи по умолчанию и тестовые учетные записи удалены, прежде чем запускать систему в производство (или подвергать ее воздействию ненадежной сети). 
